# Payment Service

Payment Service –¥–ª—è —Ä–æ—Å—Å–∏–π—Å–∫–æ–π –∏–≥—Ä–æ–≤–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã MVP. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–ª–∞—Ç–µ–∂–µ–π —Å –∏–º–∏—Ç–∞—Ü–∏–µ–π —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –¥–ª—è –º–∞–Ω—É–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üè¶ **–ò–º–∏—Ç–∞—Ü–∏—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º**: –°–±–µ—Ä–±–∞–Ω–∫, –ÆMoney, –¢-–ë–∞–Ω–∫
- üí≥ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏**: –°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ –∏–≥—Ä—ã
- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: Health checks, –º–µ—Ç—Ä–∏–∫–∏, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- üê≥ **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**: Docker –∏ docker-compose –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: Unit –∏ E2E —Ç–µ—Å—Ç—ã —Å Jest

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Framework**: NestJS + TypeScript
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL + TypeORM
- **–ö–µ—à**: Redis
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: Swagger/OpenAPI
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: Jest + Supertest
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**: Docker

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 18+
- Docker –∏ Docker Compose
- PostgreSQL 15+ (–∏–ª–∏ —á–µ—Ä–µ–∑ Docker)
- Redis 7+ (–∏–ª–∏ —á–µ—Ä–µ–∑ Docker)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
```bash
cd backend/payment-service
npm install
```

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
```

3. **–ó–∞–ø—É—Å–∫ —Å Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**
```bash
docker-compose up -d
```

4. **–ò–ª–∏ –∑–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:**
```bash
npm run start:dev
```

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

- **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**: http://localhost:3003
- **Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: http://localhost:3003/api/docs
- **Health check**: http://localhost:3003/health
- **Redis Commander**: http://localhost:8082 (–ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ docker-compose)

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ö–æ–º–∞–Ω–¥—ã

```bash
# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm run start:dev          # –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run start:debug        # –ó–∞–ø—É—Å–∫ —Å –æ—Ç–ª–∞–¥–∫–æ–π

# –°–±–æ—Ä–∫–∞
npm run build              # –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
npm run start:prod         # –ó–∞–ø—É—Å–∫ production —Å–±–æ—Ä–∫–∏

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
npm run test               # Unit —Ç–µ—Å—Ç—ã
npm run test:watch         # Unit —Ç–µ—Å—Ç—ã –≤ watch —Ä–µ–∂–∏–º–µ
npm run test:cov           # –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
npm run test:e2e           # E2E —Ç–µ—Å—Ç—ã

# –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
npm run lint               # ESLint –ø—Ä–æ–≤–µ—Ä–∫–∞
npm run format             # Prettier —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
npm run migration:generate # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏
npm run migration:run      # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
npm run migration:revert   # –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ common/                 # –û–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ filters/           # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
‚îÇ   ‚îî‚îÄ‚îÄ interceptors/      # –ò–Ω—Ç–µ—Ä—Ü–µ–ø—Ç–æ—Ä—ã
‚îú‚îÄ‚îÄ config/                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database.config.ts # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ cache.config.ts    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Redis
‚îÇ   ‚îî‚îÄ‚îÄ env.validation.ts  # –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ modules/               # –ë–∏–∑–Ω–µ—Å –º–æ–¥—É–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ health/           # Health checks
‚îÇ   ‚îú‚îÄ‚îÄ order/            # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ payment/          # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
‚îú‚îÄ‚îÄ app.module.ts         # –ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å
‚îî‚îÄ‚îÄ main.ts              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
```

## API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞, Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:
http://localhost:3003/api/docs

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

- `GET /` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–∏—Å–µ
- `GET /health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞
- `GET /orders` - –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤
- `GET /payments` - –°–ø–∏—Å–æ–∫ –ø–ª–∞—Ç–µ–∂–µ–π

## –ò–º–∏—Ç–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º

–î–ª—è MVP —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏–º–∏—Ç–∞—Ü–∏—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º:

- **–°–±–µ—Ä–±–∞–Ω–∫**: `POST /mock/sberbank`
- **–ÆMoney**: `POST /mock/yandex`
- **–¢-–ë–∞–Ω–∫**: `POST /mock/tbank`

–í—Å–µ –∏–º–∏—Ç–∞—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### Health Checks

- `GET /health` - –û–±—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
- `GET /health/ready` - –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- `GET /health/live` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é Winston. –õ–æ–≥–∏ –≤–∫–ª—é—á–∞—é—Ç:
- HTTP –∑–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã
- –û—à–∏–±–∫–∏ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã

- **User Service** (http://localhost:3001) - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **Library Service** (http://localhost:3004) - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É

### –°–æ–±—ã—Ç–∏—è

–í MVP –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è REST API –≤—ã–∑–æ–≤—ã. –í –±—É–¥—É—â–µ–º –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- Rate limiting –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç DDoS
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –ª–æ–≥–æ–≤ (—Å–∫—Ä—ã—Ç–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
- CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ò–Ω–¥–µ–∫—Å—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- Connection pooling –¥–ª—è PostgreSQL
- Graceful shutdown

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Docker

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t payment-service .

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker run -p 3003:3003 payment-service
```

### Kubernetes

Kubernetes –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–¥–∞—á–∞—Ö.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã

```bash
npm run test
```

### E2E —Ç–µ—Å—Ç—ã

```bash
npm run test:e2e
```

### –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

```bash
npm run test:cov
```

–¶–µ–ª—å: 100% –ø–æ–∫—Ä—ã—Ç–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–¥–∞.

## –í–∫–ª–∞–¥ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É

1. –°–æ–∑–¥–∞–π—Ç–µ feature branch
2. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
3. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã
4. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
5. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–ø—Ä–∏–µ—Ç–∞—Ä–Ω–æ–µ –ü–û. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.

---

**–°—Ç–∞—Ç—É—Å**: MVP –≥–æ—Ç–æ–≤ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ ‚úÖ  
**–í–µ—Ä—Å–∏—è**: 0.0.1  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: $(date)