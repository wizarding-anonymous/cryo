# Server Configuration
PORT=3001
NODE_ENV=development

# CORS Configuration
CORS_ORIGIN=http://localhost:3000

# JWT Configuration
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
JWT_REFRESH_SECRET=your-super-secret-refresh-key-change-this-in-production
JWT_EXPIRES_IN=1h
JWT_REFRESH_EXPIRES_IN=7d
JWT_ISSUER=cryo-auth-service
JWT_AUDIENCE=cryo-platform
JWT_ALGORITHM=HS256

# Database Configuration (Auth Service DB)
# For local development
DATABASE_URL=postgresql://auth_service:auth_password@localhost:5432/auth_db
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_NAME=auth_db
DATABASE_USERNAME=auth_service
DATABASE_PASSWORD=auth_password

# Database Connection Pooling
DATABASE_MAX_CONNECTIONS=20
DATABASE_MIN_CONNECTIONS=5
DATABASE_ACQUIRE_TIMEOUT=30000
DATABASE_IDLE_TIMEOUT=30000
DATABASE_CONNECTION_TIMEOUT=10000
DATABASE_RETRY_ATTEMPTS=3
DATABASE_RETRY_DELAY=3000
DATABASE_CONNECT_TIMEOUT=10000

# Migration Configuration
RUN_MIGRATIONS=false

# Redis Configuration (Event Bus + Cache)
REDIS_URL=redis://:redis_password@localhost:6379/1
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=redis_password
REDIS_DB=1
REDIS_TTL=86400
REDIS_MAX_RETRIES=3
REDIS_RETRY_DELAY=1000
REDIS_CONNECT_TIMEOUT=10000
REDIS_COMMAND_TIMEOUT=5000

# Circuit Breaker Configuration
CIRCUIT_BREAKER_TIMEOUT=3000
CIRCUIT_BREAKER_ERROR_THRESHOLD=50
CIRCUIT_BREAKER_RESET_TIMEOUT=30000
CIRCUIT_BREAKER_ROLLING_TIMEOUT=10000
CIRCUIT_BREAKER_ROLLING_BUCKETS=10
CIRCUIT_BREAKER_VOLUME_THRESHOLD=10

# User Service Circuit Breaker
USER_SERVICE_CIRCUIT_BREAKER_TIMEOUT=3000
USER_SERVICE_CIRCUIT_BREAKER_ERROR_THRESHOLD=50
USER_SERVICE_CIRCUIT_BREAKER_RESET_TIMEOUT=30000

# Security Service Circuit Breaker
SECURITY_SERVICE_CIRCUIT_BREAKER_TIMEOUT=5000
SECURITY_SERVICE_CIRCUIT_BREAKER_ERROR_THRESHOLD=60
SECURITY_SERVICE_CIRCUIT_BREAKER_RESET_TIMEOUT=60000
SECURITY_SERVICE_CIRCUIT_BREAKER_VOLUME_THRESHOLD=5

# Notification Service Circuit Breaker
NOTIFICATION_SERVICE_CIRCUIT_BREAKER_TIMEOUT=5000
NOTIFICATION_SERVICE_CIRCUIT_BREAKER_ERROR_THRESHOLD=70
NOTIFICATION_SERVICE_CIRCUIT_BREAKER_RESET_TIMEOUT=60000
NOTIFICATION_SERVICE_CIRCUIT_BREAKER_VOLUME_THRESHOLD=3

# Service URLs
USER_SERVICE_URL=http://localhost:3002
SECURITY_SERVICE_URL=http://localhost:3010
NOTIFICATION_SERVICE_URL=http://localhost:3007

# Event Bus Configuration
EVENT_BUS_RETRY_ATTEMPTS=3
EVENT_BUS_RETRY_DELAY=1000
SECURITY_EVENTS_QUEUE=security-events
NOTIFICATION_EVENTS_QUEUE=notification-events
USER_EVENTS_QUEUE=user-events

# Session Configuration
SESSION_CLEANUP_INTERVAL=3600000  # 1 hour in ms
SESSION_MAX_AGE=86400000          # 24 hours in ms
MAX_SESSIONS_PER_USER=5

# Rate Limiting
RATE_LIMIT_WINDOW=60000           # 1 minute
RATE_LIMIT_MAX_REQUESTS=100
LOGIN_RATE_LIMIT_WINDOW=900000    # 15 minutes
LOGIN_RATE_LIMIT_MAX_ATTEMPTS=5

# Async Operations Configuration
MAX_QUEUE_SIZE=10000              # Maximum items in priority queue
MAX_CONCURRENT_JOBS=100           # Maximum concurrent async operations
BACKPRESSURE_THRESHOLD=0.8        # Backpressure activation threshold (80%)
MAX_WORKER_PROCESSES=4            # Number of worker processes for CPU-intensive tasks
WORKER_SCRIPT_PATH=./worker-thread.js  # Path to worker thread script

# Performance Tuning
CRITICAL_PATH_TIMEOUT=5000        # Timeout for critical auth operations (ms)
EVENT_PROCESSING_BATCH_SIZE=10   # Batch size for event processing
ASYNC_OPERATION_TIMEOUT=30000    # Default timeout for async operations (ms)

# Saga Pattern Configuration
USE_SAGA_PATTERN=true             # Enable/disable saga pattern for transactions
SAGA_TIMEOUT=30000                # Default saga step timeout in ms (30 seconds)
SAGA_MAX_RETRIES=3                # Maximum retry attempts per saga step
SAGA_LOCK_TTL=60000               # Distributed lock TTL in ms (60 seconds)
SAGA_CLEANUP_INTERVAL=3600000     # Saga cleanup interval in ms (1 hour)
SAGA_RETENTION_HOURS=24           # How long to keep completed sagas (hours)

# Idempotency Configuration
IDEMPOTENCY_TTL_SECONDS=86400     # TTL for idempotent operations (24 hours)
IDEMPOTENCY_ENABLED=true          # Enable/disable idempotency middleware

# Async Operations Configuration
MAX_QUEUE_SIZE=10000              # Maximum items in priority queue
MAX_CONCURRENT_JOBS=100           # Maximum concurrent async operations
BACKPRESSURE_THRESHOLD=0.8        # Backpressure activation threshold (80%)

# Performance Monitoring
METRICS_RETENTION_HOURS=24        # How long to keep performance metrics
METRICS_AGGREGATION_INTERVAL=60000 # Metrics aggregation interval in ms (1 minute)
METRICS_CLEANUP_INTERVAL=300000   # Metrics cleanup interval in ms (5 minutes)

# Critical Path Optimization
CRITICAL_PATH_TIMEOUT=5000        # Timeout for critical auth operations (5 seconds)
AUTH_FLOW_FALLBACK_ENABLED=true   # Enable fallback for auth operations
ASYNC_EVENT_PROCESSING=true       # Enable async event processing with setImmediate

# Monitoring and Observability
LOG_LEVEL=info                    # Logging level (debug, info, warn, error)
STRUCTURED_LOGGING=true           # Enable structured logging with correlation IDs
PROMETHEUS_METRICS=true           # Enable Prometheus metrics collection
METRICS_PORT=9090                 # Port for Prometheus metrics endpoint

# Alerting Configuration
ALERT_WEBHOOK_URL=                # Webhook URL for critical alerts (optional)
ALERT_WEBHOOK_TOKEN=              # Authentication token for webhook (optional)
SLACK_WEBHOOK_URL=                # Slack webhook URL for notifications (optional)
SLACK_CHANNEL=#alerts             # Slack channel for alerts
ALERT_EVALUATION_INTERVAL=60000   # Alert evaluation interval in ms (1 minute)

# Alert Thresholds
AUTH_FAILURE_RATE_THRESHOLD=0.2   # Alert when auth failure rate exceeds 20%
FAILED_LOGINS_PER_IP_THRESHOLD=10 # Alert when failed logins from IP exceed 10
RESPONSE_TIME_THRESHOLD=2000      # Alert when avg response time exceeds 2s (ms)
MEMORY_USAGE_THRESHOLD=85         # Alert when memory usage exceeds 85%
RATE_LIMIT_HITS_THRESHOLD=50      # Alert when rate limit hits exceed 50 in 5 min
DB_ERROR_RATE_THRESHOLD=0.1       # Alert when DB error rate exceeds 10%
REDIS_ERROR_RATE_THRESHOLD=0.05   # Alert when Redis error rate exceeds 5%

# Correlation and Tracing
CORRELATION_ID_HEADER=x-correlation-id  # Header name for correlation ID
REQUEST_ID_HEADER=x-request-id          # Header name for request ID
TRACE_REQUESTS=true                     # Enable request tracing