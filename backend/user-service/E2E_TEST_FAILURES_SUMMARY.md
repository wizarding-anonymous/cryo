# User Service E2E Failures

- **Missing Redis dependency for the TypeORM query cache**. `RedisQueryResultCache` tries to load the Redis client and throws `TypeORMError: Cannot use cache because redis is not installed`, so the Nest application never boots in any suite (see `backend/user-service/src/cache/RedisQueryResultCache.ts:296`). Install the `redis` package for tests or disable caching in the test data source.
- **LoggingService is not provided in the test module**. `UserService` depends on `LoggingService`, but `TestAppModule` does not import or mock that provider, so module compilation aborts with `Nest can't resolve dependencies of the UserService` in every spec (see `backend/user-service/src/user/user.service.ts:39` and `backend/user-service/test/test-app.module.ts:59`).
- **GlobalExceptionFilter is instantiated without the required LoggingService**. The filter constructor expects both `HttpAdapterHost` and `LoggingService`, yet several suites pass only the adapter, which produces `TS2554` compile errors (see `backend/user-service/test/internal-api.e2e-spec.ts:62`, `backend/user-service/test/user.e2e-spec.ts:58`, and the constructor at `backend/user-service/src/common/filters/global-exception.filter.ts:65`).
- **Jest cannot parse the ESM build of uuid**. `LoggingInterceptor` imports `uuid` using ESM syntax, but the e2e Jest config does not transform that module, causing `SyntaxError: Unexpected token 'export'` during bootstrap (see `backend/user-service/src/common/interceptors/logging.interceptor.ts:12`).
- **Cleanup hooks run even when setup fails**. Many suites call `app.close()` or destroy the data source without checking that the Nest application was created, leading to `TypeError: Cannot read properties of undefined` and masking the original fault (see `backend/user-service/test/integration-redis.e2e-spec.ts:88` and `backend/user-service/test/performance-cache-database.e2e-spec.ts:54`).
- **Pending TypeORM initialisation keeps working after Jest shuts down**. Because the data source never initialises cleanly, TypeORM keeps retrying driver loading and emits `ReferenceError: You are trying to import a file after the Jest environment has been torn down` once Jest stops (triggered in suites that build `TestAppModule`, e.g. `backend/user-service/test/load-test-concurrent-users.e2e-spec.ts:17`).
