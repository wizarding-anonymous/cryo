# Требования к Social Service

## Введение

Social Service является центральным сервисом для социальных функций российской игровой платформы. Сервис отвечает за управление друзьями, чат, активность пользователей, группы и сообщества, игровые приглашения, стримы и интеграцию с российскими социальными сетями.

## Требования

### Требование 1

**Пользовательская история:** Как пользователь, я хочу добавлять друзей и управлять списком друзей, чтобы играть и общаться с ними.

#### Критерии приемки

1. КОГДА пользователь отправляет заявку в друзья ТОГДА система ДОЛЖНА уведомить получателя
2. КОГДА пользователь принимает заявку ТОГДА система ДОЛЖНА добавить обоих в списки друзей
3. КОГДА пользователь удаляет друга ТОГДА система ДОЛЖНА убрать его из списка друзей
4. ЕСЛИ пользователь заблокирован ТОГДА система НЕ ДОЛЖНА позволять отправлять заявки

### Требование 2

**Пользовательская история:** Как пользователь, я хочу видеть онлайн статус друзей и их игровую активность.

#### Критерии приемки

1. КОГДА друг заходит в сеть ТОГДА система ДОЛЖНА обновить его статус в реальном времени
2. КОГДА друг запускает игру ТОГДА система ДОЛЖНА показать в какую игру он играет
3. КОГДА пользователь просматривает список друзей ТОГДА система ДОЛЖНА показать их текущую активность
4. ЕСЛИ настройки приватности запрещают ТОГДА система НЕ ДОЛЖНА показывать активность

### Требование 3

**Пользовательская история:** Как пользователь, я хочу общаться с друзьями через встроенный чат.

#### Критерии приемки

1. КОГДА пользователь отправляет сообщение ТОГДА система ДОЛЖНА доставить его получателю в реальном времени
2. КОГДА пользователь не в сети ТОГДА система ДОЛЖНА сохранить сообщения для него
3. КОГДА пользователь создает групповой чат ТОГДА система ДОЛЖНА позволить добавлять участников
4. ЕСЛИ пользователь заблокирован ТОГДА система НЕ ДОЛЖНА доставлять его сообщения

### Требование 4

**Пользовательская история:** Как пользователь, я хочу приглашать друзей в игры, чтобы играть вместе.

#### Критерии приемки

1. КОГДА пользователь отправляет игровое приглашение ТОГДА система ДОЛЖНА уведомить друга
2. КОГДА друг принимает приглашение ТОГДА система ДОЛЖНА запустить игру или присоединить к сессии
3. КОГДА пользователь отклоняет приглашение ТОГДА система ДОЛЖНА уведомить отправителя
4. ЕСЛИ игра не поддерживает мультиплеер ТОГДА система НЕ ДОЛЖНА позволять отправлять приглашения

### Требование 5

**Пользовательская история:** Как пользователь, я хочу создавать и участвовать в группах по интересам.

#### Критерии приемки

1. КОГДА пользователь создает группу ТОГДА система ДОЛЖНА назначить его администратором
2. КОГДА пользователь присоединяется к группе ТОГДА система ДОЛЖНА добавить его в список участников
3. КОГДА в группе публикуется контент ТОГДА система ДОЛЖНА уведомить участников
4. ЕСЛИ группа приватная ТОГДА система ДОЛЖНА требовать одобрения для вступления

### Требование 6

**Пользовательская история:** Как пользователь, я хочу делиться своими достижениями и скриншотами с друзьями.

#### Критерии приемки

1. КОГДА пользователь получает достижение ТОГДА система ДОЛЖНА позволить поделиться им
2. КОГДА пользователь загружает скриншот ТОГДА система ДОЛЖНА проверить его на соответствие правилам
3. КОГДА пользователь публикует контент ТОГДА система ДОЛЖНА показать его в ленте друзей
4. ЕСЛИ контент нарушает правила ТОГДА система ДОЛЖНА скрыть его и уведомить модераторов

### Требование 7

**Пользовательская история:** Как пользователь, я хочу видеть ленту активности друзей, чтобы быть в курсе их игровой жизни.

#### Критерии приемки

1. КОГДА друг совершает действие ТОГДА система ДОЛЖНА добавить его в ленту активности
2. КОГДА пользователь просматривает ленту ТОГДА система ДОЛЖНА показать недавние события
3. КОГДА пользователь лайкает или комментирует ТОГДА система ДОЛЖНА уведомить автора
4. ЕСЛИ активность приватная ТОГДА система НЕ ДОЛЖНА показывать её в ленте

### Требование 8

**Пользовательская история:** Как пользователь, я хочу интегрировать свой аккаунт с российскими социальными сетями.

#### Критерии приемки

1. КОГДА пользователь связывает аккаунт с VK ТОГДА система ДОЛЖНА импортировать список друзей
2. КОГДА пользователь публикует достижение ТОГДА система ДОЛЖНА позволить поделиться им в соцсетях
3. КОГДА пользователь находит друзей из VK ТОГДА система ДОЛЖНА предложить добавить их
4. ЕСЛИ соцсеть недоступна ТОГДА система ДОЛЖНА работать без интеграции

### Требование 9

**Пользовательская история:** Как другой микросервис, я хочу получать информацию о социальных связях для персонализации.

#### Критерии приемки

1. КОГДА сервис запрашивает список друзей ТОГДА система ДОЛЖНА вернуть актуальную информацию
2. КОГДА сервис проверяет дружбу ТОГДА система ДОЛЖНА подтвердить или опровергнуть связь
3. КОГДА изменяется социальный граф ТОГДА система ДОЛЖНА отправить событие об изменении
4. ЕСЛИ запрос неавторизован ТОГДА система ДОЛЖНА вернуть ошибку доступа

### Требование 10

**Пользовательская история:** Как пользователь, я хочу настраивать приватность своего профиля и активности.

#### Критерии приемки

1. КОГДА пользователь изменяет настройки приватности ТОГДА система ДОЛЖНА применить их ко всем данным
2. КОГДА профиль приватный ТОГДА система ДОЛЖНА скрывать информацию от незнакомцев
3. КОГДА пользователь блокирует другого ТОГДА система ДОЛЖНА запретить любое взаимодействие
4. ЕСЛИ пользователь невидимый ТОГДА система НЕ ДОЛЖНА показывать его онлайн статус

### Требование 11

**Пользовательская история:** Как пользователь, я хочу модерировать свои группы и чаты, чтобы поддерживать порядок.

#### Критерии приемки

1. КОГДА администратор удаляет сообщение ТОГДА система ДОЛЖНА скрыть его от всех участников
2. КОГДА модератор банит пользователя ТОГДА система ДОЛЖНА запретить ему участие в группе
3. КОГДА нарушаются правила ТОГДА система ДОЛЖНА предоставить инструменты модерации
4. ЕСЛИ модератор превышает полномочия ТОГДА система ДОЛЖНА логировать его действия

### Требование 12

**Пользовательская история:** Как система, я должна обеспечивать высокую производительность социальных функций.

#### Критерии приемки

1. КОГДА пользователь отправляет сообщение ТОГДА оно ДОЛЖНО быть доставлено за время менее 100мс
2. КОГДА обновляется лента активности ТОГДА система ДОЛЖНА загрузить её за время менее 500мс
3. КОГДА происходит пиковая нагрузка ТОГДА система ДОЛЖНА поддерживать до 50000 одновременных пользователей
4. ЕСЛИ система перегружена ТОГДА она ДОЛЖНА приоритизировать критические функции

### Требование 13

**Пользовательская история:** Как пользователь, я хочу искать друзей и группы по различным критериям.

#### Критерии приемки

1. КОГДА пользователь ищет друзей ТОГДА система ДОЛЖНА найти их по имени, email, игровому тегу
2. КОГДА пользователь ищет группы ТОГДА система ДОЛЖНА найти их по названию, тегам, играм
3. КОГДА система предлагает друзей ТОГДА она ДОЛЖНА учитывать общие интересы и игры
4. ЕСЛИ результатов много ТОГДА система ДОЛЖНА ранжировать их по релевантности

### Требование 14

**Пользовательская история:** Как пользователь, я хочу получать уведомления о социальной активности.

#### Критерии приемки

1. КОГДА приходит заявка в друзья ТОГДА система ДОЛЖНА отправить push-уведомление
2. КОГДА друг заходит в игру ТОГДА система ДОЛЖНА уведомить если включены соответствующие настройки
3. КОГДА в группе новая активность ТОГДА система ДОЛЖНА уведомить участников
4. ЕСЛИ пользователь отключил уведомления ТОГДА система НЕ ДОЛЖНА их отправлять

### Требование 15

**Пользовательская история:** Как пользователь, я хочу создавать события и встречи для совместной игры.

#### Критерии приемки

1. КОГДА пользователь создает событие ТОГДА система ДОЛЖНА позволить пригласить друзей
2. КОГДА наступает время события ТОГДА система ДОЛЖНА уведомить всех участников
3. КОГДА пользователь присоединяется к событию ТОГДА система ДОЛЖНА добавить его в список участников
4. ЕСЛИ событие отменяется ТОГДА система ДОЛЖНА уведомить всех приглашенных

### Требование 16

**Пользовательская история:** Как система, я должна интегрироваться с системой стримов и трансляций.

#### Критерии приемки

1. КОГДА пользователь начинает стрим ТОГДА система ДОЛЖНА уведомить его друзей
2. КОГДА друг смотрит стрим ТОГДА система ДОЛЖНА показать это в активности
3. КОГДА стрим популярный ТОГДА система ДОЛЖНА рекомендовать его другим пользователям
4. ЕСЛИ стрим нарушает правила ТОГДА система ДОЛЖНА позволить пожаловаться на него

### Требование 17

**Пользовательская история:** Как пользователь, я хочу создавать и участвовать в турнирах с друзьями.

#### Критерии приемки

1. КОГДА пользователь создает турнир ТОГДА система ДОЛЖНА позволить настроить правила и призы
2. КОГДА турнир начинается ТОГДА система ДОЛЖНА уведомить всех участников
3. КОГДА турнир завершается ТОГДА система ДОЛЖНА определить победителей и раздать призы
4. ЕСЛИ участник нарушает правила ТОГДА система ДОЛЖНА позволить дисквалифицировать его

### Требование 18

**Пользовательская история:** Как пользователь, я хочу видеть рейтинги и достижения друзей для здоровой конкуренции.

#### Критерии приемки

1. КОГДА пользователь просматривает рейтинги ТОГДА система ДОЛЖНА показать позиции друзей
2. КОГДА друг получает редкое достижение ТОГДА система ДОЛЖНА выделить его в ленте
3. КОГДА пользователь превосходит друга ТОГДА система ДОЛЖНА показать это как достижение
4. ЕСЛИ пользователь скрывает статистику ТОГДА система НЕ ДОЛЖНА показывать её друзьям

### Требование 19

**Пользовательская история:** Как система, я должна обеспечивать безопасность и защиту от токсичного поведения.

#### Критерии приемки

1. КОГДА пользователь жалуется на контент ТОГДА система ДОЛЖНА передать жалобу модераторам
2. КОГДА обнаружено токсичное поведение ТОГДА система ДОЛЖНА автоматически применить санкции
3. КОГДА пользователь систематически нарушает правила ТОГДА система ДОЛЖНА ограничить его социальные функции
4. ЕСЛИ контент содержит запрещенный материал ТОГДА система ДОЛЖНА немедленно удалить его

### Требование 20

**Пользовательская история:** Как пользователь, я хочу экспортировать свои социальные данные для использования в других сервисах.

#### Критерии приемки

1. КОГДА пользователь запрашивает экспорт ТОГДА система ДОЛЖНА сформировать архив с его данными
2. КОГДА формируется экспорт ТОГДА система ДОЛЖНА включить список друзей, сообщения, активность
3. КОГДА экспорт готов ТОГДА система ДОЛЖНА предоставить ссылку для скачивания
4. ЕСЛИ экспорт содержит данные других пользователей ТОГДА система ДОЛЖНА анонимизировать их

### Требование 21: Комплексная реферальная система

**Пользовательская история:** Как пользователь, я хочу приглашать друзей на платформу и получать награды за их активность.

#### Критерии приемки

1. КОГДА пользователь генерирует реферальную ссылку ТОГДА система ДОЛЖНА создать уникальный код с отслеживанием источника
2. КОГДА новый пользователь регистрируется по ссылке ТОГДА система ДОЛЖНА связать его с рефералом и начислить базовую награду
3. КОГДА реферал совершает покупки ТОГДА система ДОЛЖНА начислять рефералу процент от суммы согласно программе лояльности
4. КОГДА достигаются реферальные цели ТОГДА система ДОЛЖНА предоставлять дополнительные бонусы и статусы
5. ЕСЛИ обнаружено мошенничество ТОГДА система ДОЛЖНА аннулировать связанные награды и заблокировать участников

### Требование 22: Многоуровневая реферальная программа

**Пользовательская история:** Как активный участник реферальной программы, я хочу получать награды не только за прямых рефералов, но и за их активность.

#### Критерии приемки

1. КОГДА настраивается многоуровневая система ТОГДА система ДОЛЖНА поддерживать до 3 уровней рефералов с убывающими процентами
2. КОГДА реферал второго уровня совершает покупку ТОГДА система ДОЛЖНА начислять награды рефералам первого и второго уровня
3. КОГДА анализируется реферальная сеть ТОГДА система ДОЛЖНА предоставлять визуализацию дерева рефералов
4. КОГДА рассчитываются выплаты ТОГДА система ДОЛЖНА корректно распределять награды между всеми уровнями
5. ЕСЛИ реферальная цепочка нарушается ТОГДА система ДОЛЖНА пересчитать награды для всех участников

### Требование 23: Геймификация реферальной программы

**Пользовательская история:** Как участник реферальной программы, я хочу видеть свой прогресс и соревноваться с другими участниками.

#### Критерии приемки

1. КОГДА пользователь участвует в программе ТОГДА система ДОЛЖНА отображать его реферальный уровень, прогресс и следующие цели
2. КОГДА достигаются milestone'ы ТОГДА система ДОЛЖНА награждать специальными значками, титулами и эксклюзивными привилегиями
3. КОГДА проводятся реферальные конкурсы ТОГДА система ДОЛЖНА создавать временные события с особыми наградами
4. КОГДА отображаются лидерборды ТОГДА система ДОЛЖНА показывать топ-рефералов с их достижениями
5. ЕСЛИ пользователь неактивен ТОГДА система ДОЛЖНА предлагать специальные акции для возобновления участия

### Требование 24: Социальные инструменты для рефералов

**Пользовательская история:** Как реферал, я хочу иметь удобные инструменты для приглашения друзей через различные каналы.

#### Критерии приемки

1. КОГДА создаются приглашения ТОГДА система ДОЛЖНА генерировать персонализированные сообщения для разных социальных сетей
2. КОГДА отправляются приглашения ТОГДА система ДОЛЖНА поддерживать прямую отправку через VK, Telegram, WhatsApp, email
3. КОГДА отслеживается эффективность ТОГДА система ДОЛЖНА показывать статистику по каналам приглашений
4. КОГДА настраивается контент ТОГДА система ДОЛЖНА позволять кастомизировать сообщения и добавлять личные комментарии
5. ЕСЛИ канал недоступен ТОГДА система ДОЛЖНА предоставлять альтернативные способы отправки приглашений

### Требование 25: Интеграция реферальной системы с другими сервисами

**Пользовательская история:** Как владелец реферальной программы, я должна управлять всей логикой программы и интегрироваться с другими сервисами для выполнения операций.

#### Критерии приемки

1. КОГДА получается событие о покупке от Payment Service ТОГДА система ДОЛЖНА рассчитать реферальные награды и отправить запрос на выплату обратно в Payment Service
2. КОГДА получается событие регистрации от User Service ТОГДА система ДОЛЖНА связать нового пользователя с рефералом и начислить базовую награду
3. КОГДА интегрируется с Game Catalog Service ТОГДА система ДОЛЖНА запрашивать применение специальных реферальных скидок
4. КОГДА достигаются реферальные milestone'ы ТОГДА система ДОЛЖНА запрашивать создание достижений в Achievement Service
5. ЕСЛИ Payment Service не может обработать выплату ТОГДА система ДОЛЖНА обновить статус награды и уведомить пользователя

### Требование 26: Аналитика и отчетность реферальной программы

**Пользовательская история:** Как администратор программы, я хочу анализировать эффективность реферальной системы и оптимизировать ее.

#### Критерии приемки

1. КОГДА анализируется эффективность ТОГДА система ДОЛЖНА предоставлять метрики конверсии, LTV рефералов, ROI программы
2. КОГДА создаются отчеты ТОГДА система ДОЛЖНА показывать топ-рефералов, самые эффективные каналы, тренды роста
3. КОГДА сегментируются пользователи ТОГДА система ДОЛЖНА анализировать поведение рефералов vs органических пользователей
4. КОГДА прогнозируется рост ТОГДА система ДОЛЖНА использовать исторические данные для предсказания будущих результатов
5. ЕСЛИ обнаружены аномалии ТОГДА система ДОЛЖНА создавать алерты для проверки потенциального мошенничества