# Требования к API Gateway (MVP) - Месяц 2

## Введение

API Gateway - критически важный микросервис для MVP российской игровой платформы. Разрабатывается в **Месяце 2** после завершения базовых сервисов. Обеспечивает единую точку входа для frontend с базовой маршрутизацией, аутентификацией и простым rate limiting через REST API с поддержкой Docker и 100% покрытием тестами.

## Требования

### Требование 1 (Базовая маршрутизация)

**Пользовательская история:** Как frontend приложение, я хочу обращаться к единому API, чтобы получать данные от всех микросервисов.

#### Критерии приемки

1. КОГДА frontend отправляет запрос к /api/users ТОГДА Gateway ДОЛЖЕН маршрутизировать к User Service
2. КОГДА frontend запрашивает /api/games ТОГДА Gateway ДОЛЖЕН направить к Game Catalog Service
3. КОГДА frontend обращается к /api/payments ТОГДА Gateway ДОЛЖЕН перенаправить к Payment Service
4. ЕСЛИ сервис недоступен ТОГДА Gateway ДОЛЖЕН вернуть ошибку 503

### Требование 2 (Базовая аутентификация)

**Пользовательская история:** Как система безопасности, я хочу чтобы защищенные запросы проходили проверку токенов.

#### Критерии приемки

1. КОГДА приходит запрос с JWT токеном ТОГДА Gateway ДОЛЖЕН проверить его через User Service
2. КОГДА токен валиден ТОГДА Gateway ДОЛЖЕН пропустить запрос к целевому сервису
3. КОГДА токен отсутствует для защищенного ресурса ТОГДА Gateway ДОЛЖЕН вернуть ошибку 401
4. ЕСЛИ токен недействителен ТОГДА Gateway ДОЛЖЕН вернуть ошибку 403

### Требование 3 (Простой rate limiting)

**Пользовательская история:** Как администратор, я хочу ограничивать количество запросов, чтобы защитить систему от перегрузки.

#### Критерии приемки

1. КОГДА пользователь превышает 100 запросов в минуту ТОГДА Gateway ДОЛЖЕН вернуть ошибку 429
2. КОГДА IP делает слишком много запросов ТОГДА Gateway ДОЛЖЕН временно ограничить доступ
3. КОГДА запрос проходит лимиты ТОГДА Gateway ДОЛЖЕН добавить заголовки с информацией о лимитах
4. ЕСЛИ лимит превышен ТОГДА Gateway ДОЛЖЕН логировать это событие

### Требование 4 (Стандартизация ответов)

**Пользовательская история:** Как frontend разработчик, я хочу получать консистентные ответы от API, чтобы упростить обработку.

#### Критерии приемки

1. КОГДА происходит ошибка ТОГДА Gateway ДОЛЖЕН возвращать стандартный формат {error, message, code}
2. КОГДА запрос успешен ТОГДА Gateway ДОЛЖЕН добавлять заголовки CORS для frontend
3. КОГДА сервис возвращает данные ТОГДА Gateway ДОЛЖЕН добавить timestamp и request-id
4. ЕСЛИ формат ответа нестандартный ТОГДА Gateway ДОЛЖЕН нормализовать его

### Требование 5 (Архитектурные требования MVP)

**Пользовательская история:** Как DevOps инженер, я хочу развернуть API Gateway в Kubernetes, чтобы обеспечить единую точку входа.

#### Критерии приемки

1. КОГДА сервис развертывается ТОГДА он ДОЛЖЕН работать в Docker контейнере
2. КОГДА команда тестирует сервис ТОГДА покрытие тестами ДОЛЖНО быть 100%
3. КОГДА происходит маршрутизация ТОГДА время ответа ДОЛЖНО быть < 200ms
4. ЕСЛИ нагрузка увеличивается ТОГДА сервис ДОЛЖЕН поддерживать 1000 одновременных пользователей

## Ограничения MVP (Месяц 2)

### Что НЕ включено в API Gateway MVP:
- ❌ Агрегация данных от нескольких сервисов - **После MVP**
- ❌ Продвинутое кэширование - **После MVP**
- ❌ Circuit breaker pattern - **После MVP**
- ❌ Трансформация данных - **После MVP**
- ❌ Мониторинг и метрики - **После MVP**
- ❌ Load balancing между инстансами - **После MVP**
- ❌ WebSocket проксирование - **После MVP**
- ❌ Event-driven интеграции - **Только REST API для MVP**
- ❌ GraphQL поддержка - **После MVP**
- ❌ API композиция - **После MVP**
- ❌ Система API ключей - **После MVP**
- ❌ Service Mesh интеграция - **После MVP**
- ❌ Multi-tenancy - **После MVP**

### Технические требования MVP:
- ✅ REST API маршрутизация
- ✅ Docker контейнеризация
- ✅ 100% покрытие тестами
- ✅ Kubernetes готовность
- ✅ Базовая JWT аутентификация
- ✅ Простой rate limiting (по IP)

## Критерии готовности MVP (Месяц 2)

### Функциональные критерии:
1. ✅ Маршрутизация к User, Game Catalog, Payment, Library, Download сервисам
2. ✅ Проверка JWT токенов для защищенных ресурсов
3. ✅ Базовый rate limiting для защиты от перегрузки
4. ✅ Стандартизированные ответы и обработка ошибок
5. ✅ CORS поддержка для frontend приложения

### Технические критерии:
1. ✅ Docker образ собирается и запускается
2. ✅ Все тесты проходят (100% покрытие)
3. ✅ Маршрутизация работает за время < 200ms
4. ✅ Поддержка 1000 одновременных пользователей
5. ✅ Готовность к развертыванию в Kubernetes
